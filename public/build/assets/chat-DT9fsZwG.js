import{r as a,j as e,c as E}from"./client-3DVn_WlK.js";function I(){var x,g,j,f;const[r,h]=a.useState([]),[c,u]=a.useState(""),[n,b]=a.useState(null),[i,v]=a.useState(!1),[p,l]=a.useState(null),d=localStorage.getItem("auth_token"),y=(g=(x=document.getElementById("chat-app"))==null?void 0:x.dataset)==null?void 0:g.username;(f=(j=document.getElementById("chat-app"))==null?void 0:j.dataset)==null||f.user;const w=async()=>{try{const t=await(await fetch(`/api/chat?event_id=${n||""}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}})).json();h(t);const m=t[t.length-1];m&&m.message.includes(`@${y}`)&&(l(`You were mentioned by ${m.user.name}`),setTimeout(()=>l(null),4e3))}catch(s){console.error("Error fetching messages",s)}};a.useEffect(()=>{d&&w()},[n]);const N=async()=>{if(!c.trim())return;const s=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({message:c,event_id:n})});if(s.ok){const t=await s.json();h([...r,t.data]),u("")}else{const t=await s.json();alert(t.message||"Failed to send message.")}},C=s=>s.replace(/@(\w+)/g,'<span class="text-primary fw-bold">@$1</span>');return e.jsxs("div",{className:"chat-wrapper",style:{position:"fixed",bottom:20,right:20,zIndex:9999},children:[e.jsxs("div",{className:"card shadow",style:{width:"100%",maxWidth:"500px"},children:[e.jsxs("div",{className:"card-header bg-primary text-white d-flex justify-content-between align-items-center",children:[e.jsx("span",{children:"💬 Fan Zone Chat"}),e.jsxs("select",{className:"form-select mx-2",value:n||"",onChange:s=>b(s.target.value||null),children:[e.jsx("option",{value:"",children:"🌍 Global Chat"}),e.jsx("option",{value:"1",children:"Event: Arsenal vs Chelsea"}),e.jsx("option",{value:"2",children:"Event: Nigeria vs Ghana"})]}),e.jsx("button",{className:"btn btn-sm btn-light",onClick:()=>v(!i),title:"Toggle",children:i?"🔼":"🔽"})]}),!i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card-body",style:{height:300,overflowY:"auto",background:"#fffbea"},children:r.map((s,t)=>e.jsxs("div",{className:"mb-1",children:[e.jsx("strong",{children:s.user.name}),": ",e.jsx("span",{dangerouslySetInnerHTML:{__html:C(s.message)}})]},t))}),e.jsxs("div",{className:"card-footer d-flex",children:[e.jsx("input",{className:"form-control me-2",value:c,onChange:s=>u(s.target.value),placeholder:"Type your message..."}),e.jsx("button",{className:"btn btn-success",onClick:N,children:"Send"})]})]})]}),p&&e.jsx("div",{className:"position-fixed bottom-0 end-0 p-3",style:{zIndex:1050},children:e.jsx("div",{className:"toast show align-items-center text-bg-primary border-0",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"toast-body",children:p}),e.jsx("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:()=>l(null)})]})})})]})}const o=document.getElementById("chat-app");o&&E.createRoot(o).render(e.jsx(I,{userId:o.dataset.user,username:o.dataset.username}));
